# 智慧采购原型 V2 分阶段需求文档（功能2-4）

## 1. 文档目标

在“原型自用、快速验证价值”的前提下，定义以下三类能力的分阶段需求：

1. 业务功能增强（原路线图第2类）
2. 前端体验与性能优化（原路线图第3类）
3. 测试与工程化建设（原路线图第4类）

---

## 2. 范围与约束

### 2.1 本期范围

- 覆盖现有模块：需求审查、价格参考、合同分析、AI 对话、综合分析。
- 不引入复杂多租户和企业级权限中心。
- 以单团队本地开发与原型演示为目标。

### 2.2 非目标（本期不做）

- 高可用分布式部署与容灾。
- 复杂财务/采购审批流程编排。
- 全量生产级安全加固（后续阶段处理）。

---

## 3. 分阶段需求总览

## Phase A（业务能力增强）

### A1. 统一采购分析工作流

- 用户可在一个流程里完成“需求审查 -> 价格分析 -> 合同风险 -> 综合结论”。
- 支持只输入文本，不强制上传文件。
- 输出结构化结果，便于保存和回溯。

验收标准：
- 一次请求返回四类结果及总评。
- 前端单页可完整展示分析链路，无需跨页跳转。

### A2. 结论可解释与可追溯

- 每条结论必须有来源依据：
  - 命中的规则 ID/规则说明；
  - 价格参考来源与时间；
  - 合同命中条款原文片段。
- 前端支持展开查看“依据详情”。

验收标准：
- 综合分析结果中 `evidence` 字段完整可用。
- 报告中任意风险或建议都能定位到依据条目。

### A3. 场景模板与半自动填充

- 提供常见采购模板（服务器、工作站、仪器仪表）。
- 用户可选择模板快速生成初始输入，再手动调整。

验收标准：
- 至少 3 个模板可用。
- 模板输入后可直接触发分析流程。

### A4. 分析历史与复用

- 保存分析记录，支持列表检索与二次分析。
- 支持“基于历史记录重新分析”。

验收标准：
- 可查看最近 50 条分析记录。
- 任意历史记录可一键复制为新分析输入。

## Phase B（体验与性能）

### B1. 关键页面拆分与组件化

- 将超大页面拆为容器页 + 功能子组件：
  - 输入区、结果区、图表区、说明区。
- 降低单文件维护难度。

验收标准：
- `Requirements.vue`、`Contract.vue`、`Price.vue` 三页拆分完成。
- 任一页面主文件行数显著下降，功能行为不回归。

### B2. 首屏与交互性能优化

- 路由级与重组件级懒加载。
- 图表按需渲染，避免首屏一次性加载。
- 大结果块增量渲染。

验收标准：
- 构建产物超大 chunk 数量下降。
- 首屏交互时间显著改善（对比当前基线）。

### B3. 状态体验统一

- 统一空状态、加载态、错误态、权限态组件。
- API 异常信息标准化映射到用户提示。

验收标准：
- 关键页面都使用统一状态组件。
- 前端不再出现风格不一致的错误提示。

### B4. 草稿与恢复

- 表单自动草稿（localStorage）与恢复提示。
- 支持手动清空草稿。

验收标准：
- 刷新后可恢复输入内容。
- 用户可关闭自动恢复并清空缓存。

## Phase C（测试与工程化）

### C1. 后端测试基线

- 建立 `pytest` 测试目录和最小可运行测试集。
- 覆盖 auth、requirements、price、contract、chat 核心接口。

验收标准：
- 本地一条命令可运行全部后端测试。
- 关键 API 覆盖到“成功 + 参数错误”两类路径。

### C2. 前端测试基线

- 引入单元测试框架（建议 Vitest）。
- 优先覆盖 composables 与关键数据转换逻辑。

验收标准：
- 至少 10 个稳定单测用例。
- 核心 composables 具备基础回归保障。

### C3. E2E 冒烟流程

- 固化 3 条高价值流程：
  - 登录 -> 分析 -> 查看结果；
  - 模板生成 -> 调整 -> 提交；
  - 历史记录复用 -> 再分析。

验收标准：
- Playwright 脚本可在本地复现执行。
- 每次发版前可快速回归关键路径。

### C4. CI 与质量门禁

- 建立最小 CI：lint + test + build。
- 设置失败阻断机制，避免带病合并。

验收标准：
- 新提交自动触发检查。
- 任一关键检查失败时 CI 红灯。

---

## 4. 里程碑

1. M1（Phase A 完成）：综合分析能力闭环且可追溯。
2. M2（Phase B 完成）：核心页面结构稳定，交互性能可接受。
3. M3（Phase C 完成）：具备可重复回归与自动质量门禁。

---

## 5. 成功指标（原型阶段）

- 功能可用性：一次分析成功率 >= 95%（本地演示场景）。
- 结果可解释性：100% 结论可定位证据。
- 体验效率：常用场景从输入到结论 <= 2 分钟。
- 质量保障：每次迭代有自动化验证结果可追踪。
